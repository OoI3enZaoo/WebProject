<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	

	<title>Light Bootstrap Dashboard by Creative Tim</title>



<!--   Core JS Files   -->
    <script src="bower_components/jquery/dist/jquery.js"></script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


       <!-- Bootstrap core CSS     -->
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Animation library for notifications   -->
    <link href="bower_components/bootstrap/dist/css/animate.min.css" rel="stylesheet"/>


<!--  Light Bootstrap Table core CSS    -->
    <link href="bower_components/bootstrap/dist/css/light-bootstrap-dashboard.css" rel="stylesheet"/>
    
  
      <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="bower_components/other/css/demo.css" rel="stylesheet" />



<!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="bower_components/font/css/pe-icon-7-stroke.css" rel="stylesheet" />

  
  
  <link rel="stylesheet" href = "bower_components/jquery/src/css/jquery-ui.css">
    
  <script src="bower_components/jquery/dist/jqeury-ui.js"></script>
  
  
<style type="text/css">

  #legend {
    background: #FFF;
    padding: 10px;
    margin: 5px;
    font-size: 12px;
    font-family: Arial, sans-serif;
  }

  .color {
    border: 1px solid;
    height: 12px;
    width: 12px;
    margin-right: 3px;
    float: left;
  }

  .blue {
    background: #4d4dff;
  }

  .green {
    background: #4dff88;
  }

  .yellow {
    background: #ffff4d;
  }

  .orange {
    background: #ff944d;
  }

  .red {
    background: #ff4d4d;
  }
</style>

  
</head>
<body>

	





<div class="wrapper">
    <div class="sidebar" data-color="blue" data-image="bower_components/font/img/sidebar-5.jpg">


    	<div class="sidebar-wrapper">
            <div class="logo">
                <a href="index.html" class="simple-text">
                    Home Page
                </a>
            </div>

            <ul class="nav">
                <li>
                    <a href="dashboard.html">
                        <i class="pe-7s-graph"></i>
                        <p>Dashboard</p>
                    </a>
                </li>

                <li >
                    <a href="airpollution.html">
                        <i class="pe-7s-compass"></i>
                        <p>Air pollution</p>
                    </a>
                </li>


                 <li class="active">
                    <a href="history.html">
                        <i class="pe-7s-back"></i>
                        <p>History</p>
                    </a>
                </li>
                
                <li>
                    <a href="aqi.html">
                        <i class="pe-7s-display1"></i>
                        <p>Air Quality Index </p>
                    </a>
                </li>


            </ul>

    	</div>
    </div>
    

    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">History</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-left">
                     

                         <li class="dropdown">
                              <a class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-globe"></i>
                                    <b class="caret"></b>
                                    <span class="notification">5</span>
                              </a>
                              <ul class="dropdown-menu">
                              
                                <li><a href="#">Notification 1</a></li>
                                <li><a href="#">Notification 2</a></li>
                                <li><a href="#">Notification 3</a></li>
                                <li><a href="#">Notification 4</a></li>
                                <li><a href="#">Another notification</a></li>
                              </ul>
                        </li>
                        <li>
                           <a href=""  data-toggle="modal" data-target="#myModalHorizontal">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                        
                        


                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                           <a href="">
                               Account
                            </a>
                        </li>


                    </ul>
                </div>
            </div>
                                              
        </nav>


 



   <div id="map"></div>
   
    </div>
    
    
</div>



<!-- Modal -->
<div class="modal fade" id="myModalHorizontal" tabindex="-1" role="dialog" 
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <button type="button" class="close" 
                   data-dismiss="modal">
                       <span aria-hidden="true">&times;</span>
                       <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    Search System
                </h4>
            </div>
            
            <!-- Modal Body -->
            <div class="modal-body">
                
                <form class="form-horizontal" role="form">
                  <div class="form-group">
                    <label  class="col-sm-2 control-label"
                             >Date</label>
                    <div class="col-sm-10">
                        <input class="form-control" 
                        id="txtDate" placeholder="Pick your Date"/>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label" >Time</label>                                                   
                    <div class="col-sm-10">
                        
                        
                        <div class="dropdown">
								   <button id = "mTime" class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Time
    								<span class="caret"></span></button>
								  <ul class="dropdown-menu">																   
								  	<li><a href="#"  data-value= "00.00">00.00</a></li>
									<li><a href="#"  data-value= "01.00">01.00</a></li>
									<li><a href="#"  data-value= "02.00">02.00</a></li>
									<li><a href="#"  data-value= "03.00">03.00</a></li>
									<li><a href="#"  data-value= "04.00">04.00</a></li>
									<li><a href="#"  data-value= "05.00">05.00</a></li>
									<li><a href="#"  data-value= "06.00">06.00</a></li>
									<li><a href="#"  data-value= "07.00">07.00</a></li>
									<li><a href="#"  data-value= "08.00">08.00</a></li>
									<li><a href="#"  data-value= "09.00">09.00</a></li>
									<li><a href="#"  data-value= "10.00">10.00</a></li>
									<li><a href="#"  data-value= "11.00">11.00</a></li>
									<li><a href="#"  data-value= "12.00">12.00</a></li>
									<li><a href="#"  data-value= "13.00">13.00</a></li>
									<li><a href="#"  data-value= "14.00">14.00</a></li>
									<li><a href="#"  data-value= "15.00">15.00</a></li>
									<li><a href="#"  data-value= "16.00">16.00</a></li>
									<li><a href="#"  data-value= "17.00">17.00</a></li>
									<li><a href="#"  data-value= "18.00">18.00</a></li>
									<li><a href="#"  data-value= "19.00">19.00</a></li>
									<li><a href="#"  data-value= "20.00">20.00</a></li>
									<li><a href="#"  data-value= "21.00">21.00</a></li>
									<li><a href="#"  data-value= "22.00">22.00</a></li>
									<li><a href="#"  data-value= "23.00">23.00</a></li>
		
								  </ul>
								</div>    
								
                    </div>
                  </div>
               	 <div class="form-group">
                    <label class="col-sm-2 control-label"
                          >District</label>
                    <div class="col-sm-10">
                        <input  class="form-control"
                            id="txtDistrict" placeholder="Pick your District"/>
                    </div>
                  </div>
                   <div class="form-group">
                    <label  class="col-sm-2 control-label"
                             ></label>
                    <div class="col-sm-10">
                        <p id= "txtError" style="color:#ff0000;"></p>
                    </div>
                  </div>
                  
               
               
                </form>
                
                
                
                
                
                
            </div>
            
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">
                            Close
                </button>
                <button id= "DateSearch" type="button" class="btn btn-primary">
                   Search
                </button>
            </div>
        </div>
    </div>
</div>

</body>
   
      <!--  Google Map Plugin -->
   <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWgbWYxPgHHo-PU4IuhjjZhjh1PXfhYkc&callback=initMap"
  type="text/javascript"></script>
  

 
  
  
 <script type="text/javascript">
$(function(){
	
	  $("#txtDate").datepicker();	  
	  $(".dropdown-menu li a").click(function(){
		  $(this).parents(".dropdown").find('.btn').html($(this).text() + ' <span class="caret"></span>');
		  $(this).parents(".dropdown").find('.btn').val($(this).data('value'));
	});		
	  
});
 

function checkTime(time){
	
	if(time == "00.00"){
		return "0";
	}
	if(time == "01.00"){
		return "1";
	}
	if(time == "02.00"){
		return "2";
	}
	if(time == "03.00"){
		return "3";
	}
	if(time == "04.00"){
		return "4";
	}
	if(time == "05.00"){
		return "5";
	}
	if(time == "06.00"){
		return "6";
	}
	if(time == "07.00"){
		return "7";
	}
	if(time == "08.00"){
		return "8";
	}
	if(time == "09.00"){
		return "9";
	}
	if(time == "10.00"){
		return "10";
	}
	if(time == "11.00"){
		return "11";
	}
	if(time == "12.00"){
		return "12";
	}
	if(time == "13.00"){
		return "13";
	}
	if(time == "14.00"){
		return "14";
	}
	if(time == "15.00"){
		return "15";
	}
	if(time == "16.00"){
		return "16";
	}
	if(time == "17.00"){
		return "17";
	}
	if(time == "18.00"){
		return "18";
	}
	if(time == "19.00"){
		return "19";
	}
	if(time == "20.00"){
		return "20";
	}
	if(time == "21.00"){
		return "21";
	}
	if(time == "22.00"){
		return "22";
	}
	if(time == "23.00"){
		return "23";
	}
	
		
}

function getDistrictFromLatlng(lat, lng){	
 	var myLocation = [["13.736623", "100.563866"],["13.757873","100.53623"]];		
	for(i = 0; i<myLocation.length; i++){ 
		$.getJSON("http://maps.googleapis.com/maps/api/geocode/json?latlng="+myLocation[i][0]+","+myLocation[i][1]+"&sensor=true",function(result){						
			for(j = 0; j<result.results[0].address_components.length; j++){			
				if(result.results[0].address_components[j].long_name.match(/^เขต.*$/)){									
						var myDistrict = result.results[0].address_components[j].long_name
						var mResult = myDistrict.replace("เขต ","");
						console.log(mResult);
						//return mResult;
						
				}
				
			}
		});
		                 
	}
}
                 
                 
 function getAQIColor(number){
  	
  	var color;
  	if(number > 300){
  		return  "#ff4d4d";//red
  	}
  	if(number > 201){
  		return  "#ff944d";//orange
  	}
  	if(number > 100){
  		return   "#ffff4d";//yellow
  	}
  	if(number > 51){
  		return "#4dff88"//green
  	}
  	else{
  		return  "#4d4dff";//blue
  		
  	}
  	return null;
  } 
 function getNotification(micon,mtype,mdata)
 {
	 
	 $.notify({
	        icon: micon,//icon
	        message: mdata//data

	    },{
	        type: mtype, //type  danger ,warning ,success ,info
	        timer: 4000
	    });		
	 
	 
 }
 
 
 
function initMap() {
	
	$('#DateSearch').click(function(){
		
		var count = 0; 
		var strDate = document.getElementById("txtDate").value;					
		var f = strDate.substr(0,2);
		var s = strDate.substr(3,2);
		var t = strDate.substr(6,9);
		var mDate = t+'-'+f+'-'+s;// days
		var mTime = document.getElementById("mTime").value;	//time
		var mDistrict = document.getElementById("txtDistrict").value;//district
		
		if(mDate != "--"){		
			if(mTime != ""){
				if(mDistrict != ""){
					$('#myModalHorizontal').modal('toggle');
											
					console.log('date: ' + mDate + ' mTime: ' + mTime);								
					$.getJSON('http://sysnet.utcc.ac.th/aparcas/History.jsp',function(result){					
						var time = checkTime(mTime);
						console.log('checkTime(time): ' +time);
						for(i = 0; i< result.AQI_History.length; i++){						
							if(result.AQI_History[i].id_district = mDistrict){
								if(result.AQI_History[i].date == mDate){									
									var mAQI;
									if(time == "0"){
										mAQI= result.AQI_History[i].AQI0;
										console.log('result: ' +mAQI);															
									}
									else if(time == "1"){
										mAQI= result.AQI_History[i].AQI1;
										console.log('result: ' +mAQI);					
									}
									else if(time == "2"){
										mAQI= result.AQI_History[i].AQI2;
										console.log('result: ' +mAQI);
									}
									else if(time == "3"){
										mAQI= result.AQI_History[i].AQI3;
										console.log('result: ' +mAQI);
									}
									else if(time == "4"){
										mAQI= result.AQI_History[i].AQI4;
										console.log('result: ' +mAQI);
									}
									else if(time == "5"){
										mAQI= result.AQI_History[i].AQI5;
										console.log('result: ' +mAQI);
									}
									else if(time == "6"){
										mAQI= result.AQI_History[i].AQI6;
										console.log('result: ' +mAQI);
									}
									else if(time == "7"){
										mAQI= result.AQI_History[i].AQI7;
										console.log('result: ' +mAQI);
									}
									else if(time == "8"){
										mAQI= result.AQI_History[i].AQI8;
										console.log('result: ' +mAQI);
									}
									else if(time == "9"){
										mAQI= result.AQI_History[i].AQI9;
										console.log('result: ' +mAQI);
									}
									else if(time == "10"){
										mAQI= result.AQI_History[i].AQI10;
										console.log('result: ' +mAQI);
									}
									else if(time == "11"){
										mAQI= result.AQI_History[i].AQI11;
										console.log('result: ' +mAQI);
									}
									else if(time == "12"){
										mAQI= result.AQI_History[i].AQI12;
										console.log('result: ' +mAQI);
									}
									else if(time == "13"){
										mAQI= result.AQI_History[i].AQI13;
										console.log('result: ' +mAQI);
									}
									else if(time == "14"){
										mAQI= result.AQI_History[i].AQI14;
										console.log('result: ' +mAQI);
									}
									else if(time == "15"){
										mAQI= result.AQI_History[i].AQI15;
										console.log('result: ' +mAQI);
									}
									else if(time == "16"){
										mAQI= result.AQI_History[i].AQI16;
										console.log('result: ' +mAQI);
									}
									else if(time == "17"){
										mAQI= result.AQI_History[i].AQI17;
										console.log('result: ' +mAQI);
									}
									else if(time == "18"){
										mAQI= result.AQI_History[i].AQI18;
										console.log('result: ' +mAQI);
									}
									else if(time == "19"){
										mAQI= result.AQI_History[i].AQI19;
										console.log('result: ' +mAQI);
									}
									else if(time == "20"){
										mAQI= result.AQI_History[i].AQI20;
										console.log('result: ' +mAQI);
									}
									else if(time == "21"){
										mAQI= result.AQI_History[i].AQI21;
										console.log('result: ' +mAQI);
									}
									else if(time == "22"){
										mAQI= result.AQI_History[i].AQI22;
										console.log('result: ' +mAQI);
									}
									else if(time == "23"){
										mAQI= result.AQI_History[i].AQI23;
										console.log('result: ' +mAQI);
									}									
									if(count == 0){									
										count++;
										console.log('district: ' + result.AQI_History[i].id_district + ' AQI: ' + mAQI);
										setCircleOnMap(result.AQI_History[i].id_district,mAQI);										
										getNotification("pe-7s-smile","success","<b>Success</b> scroll down for see your result.");//icon,type,message
									}
								}								
							}
						}																										 																									
						
					});//getJSON	
				}else{
					
					document.getElementById('txtError').innerHTML = '<b>Error</b>  Please complete your District';
					getNotification("pe-7s-close-circle","danger","<b>Error</b> Please complete your District");
					
					
			}
			}else{
				
				document.getElementById('txtError').innerHTML = '<b>Error</b>  Please complete your time';
				getNotification("pe-7s-close-circle","danger","<b>Error</b> Please complete your time");
				
				
		}// end of else of time
		}else{
			
			document.getElementById('txtError').innerHTML = '<b>Error:</b>  Please complete your date';
			getNotification("pe-7s-close-circle","danger","<b>Error:</b>  Please complete your Date");
			
		}		// end of else of date
	});//date Click
	
	
  var myLatLng = {lat: 13.755506, lng: 100.506470};
  
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 8,
        center: myLatLng,
        mapTypeId: 'terrain'
      });   //end of map
      
  
     function setCircleOnMap(district,mAQI){    
    	var mLayer;
      console.log('setCircleOnMap(' + district+','+mAQI+')');   
    	
      var infoWindow = new google.maps.InfoWindow();

        // Initialize the first layer
        mLayer = new google.maps.FusionTablesLayer({
          query: {
            select: 'geometry',
            from: '17Vj_x8KaduQcuxi_C0M6teVPKoId_7qQyyJC_zRs',
            where : "ID_2 = "+district
          },
          map: map,
        
          suppressInfoWindows: true ,
          styles: [{        	  
        	  polygonOptions: {
        	    fillColor: getfillColor(mAQI),
        	    strokeColor: getStrokeColor(mAQI),
        	    strokeWeight: 2
        	  }
        	}]                   
        });
        //map.setZoom(11);
        var infoWindow;
        var infoWindow = new google.maps.InfoWindow({
		     content: "<div><b>Air Pollution Report</b></div><div>AQI: "+mAQI+"</div>",
		      maxWidth: 500
		});
        google.maps.event.addListener(mLayer, 'click', function(ev) {
         // windowControl(e, infoWindow, map);
        	infoWindow.setPosition(ev.latLng);
        	infoWindow.open(map);
        });
        
        
       

	}//setcircle on map
     
     
 
     // Create the legend and display on the map
     var legend = document.createElement('div');
     legend.id = 'legend';
     var content = [];
     content.push('<h3>Air Quality Index</h3>');
     content.push('<p><div class="color blue"></div>0-50 Good</p>');
     content.push('<p><div class="color green"></div>51-100 Moderate</p>');
     content.push('<p><div class="color yellow"></div>100-200 Unhealthy for Sensitive Groups</p>');
     content.push('<p><div class="color orange"></div>201-300 Unhealthy</p>');
     content.push('<p><div class="color red"></div>300+ Very Unhealty</p>');     
     legend.innerHTML = content.join('');
     legend.index = 1;
     map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
   

}

  function getfillColor(number){
  	
  	var color;
  	if(number > 300){
  		return  "#ff4d4d";//red
  	}
  	if(number > 201){
  		return  "#ff944d";//orange
  	}
  	if(number > 100){
  		return   "#ffff4d";//yellow
  	}
  	if(number > 51){
  		return "#4dff88"//green
  	}
  	else{
  		return  "#4d4dff";//blue
  		
  	}
  	return null;
  } 
  
  function getStrokeColor(number){
	  	
	  	
	  	if(number > 300){
	  		return "#ff0000";//red
	  	}
	  	if(number > 201){
	  		return  "#ff6600";//orange
	  	}
	  	if(number >100){
	  		return   "#ffff00";//yellow
	  	}
	  	if(number > 51){
	  		return  "#00cc00"//green
	  	}
	  	else{
	  		return   "#0066ff";//blue	  		
	  	}
	  	return null;
	  } 
  



</script>

    
	<script src="bower_components/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>

	<!--  Checkbox, Radio & Switch Plugins -->
  <script src="bower_components/bootstrap/dist/js/bootstrap-checkbox-radio-switch.js"></script>


    <!--  Notifications Plugin    -->
    
    <script src="bower_components/bootstrap/dist/js/bootstrap-notify.js"></script>

   

    <!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
	 <script src="bower_components/font/js/light-bootstrap-dashboard.js"></script>

	<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
	<script src="bower_components/font/js/demo.js"></script>


</html>


